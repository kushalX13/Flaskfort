<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FlaskFort Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-[#F7F6F3] text-[#2F3437]">
    <div class="max-w-screen-lg mx-auto px-6 py-12">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-semibold">Welcome back</h1>
          <p class="text-sm text-[#6B6F76]">Register or log in to access your private notes.</p>
        </div>
        <a class="text-[#6B6F76] hover:text-black" href="/">Home</a>
      </div>

      <div class="grid gap-6 mt-6 md:grid-cols-2">
        <div class="rounded-xl border border-black/10 bg-white p-5">
          <h2 class="font-semibold">Register</h2>
          <label class="block text-sm mt-3">Email</label>
          <input id="reg_email" type="email" class="w-full rounded bg-[#F7F6F3] px-3 py-2 border border-black/10" />
          <label class="block text-sm mt-3">Password</label>
          <input id="reg_password" type="password" class="w-full rounded bg-[#F7F6F3] px-3 py-2 border border-black/10" />
          <button class="mt-4 rounded bg-[#2F3437] text-white px-3 py-2" onclick="register()">
            Register
          </button>
          <pre id="reg_out" class="mt-3 text-xs bg-[#F7F6F3] p-2 rounded"></pre>
        </div>

        <div class="rounded-xl border border-black/10 bg-white p-5">
          <h2 class="font-semibold">Login</h2>
          <label class="block text-sm mt-3">Email</label>
          <input id="login_email" type="email" class="w-full rounded bg-[#F7F6F3] px-3 py-2 border border-black/10" />
          <label class="block text-sm mt-3">Password</label>
          <input id="login_password" type="password" class="w-full rounded bg-[#F7F6F3] px-3 py-2 border border-black/10" />
          <button class="mt-4 rounded bg-[#1F9D55] text-white px-3 py-2" onclick="login()">
            Login
          </button>
          <button class="mt-2 rounded bg-[#F7F6F3] px-3 py-2 border border-black/10" onclick="clearToken()">
            Clear Token
          </button>
          <div id="token_out" class="mt-2 text-xs break-all"></div>
          <pre id="login_out" class="mt-3 text-xs bg-[#F7F6F3] p-2 rounded"></pre>
        </div>
      </div>

      <div class="mt-6 flex gap-3">
        <a class="rounded bg-[#2F3437] text-white px-3 py-2" href="/notes-ui">Go to Notes</a>
        <a class="rounded bg-white px-3 py-2 border border-black/10" href="/docs">API Docs</a>
      </div>
    </div>

    <script>
      const tokenKey = "flaskfort_token";

      async function register() {
        const res = await fetch(`/auth/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: document.getElementById("reg_email").value,
            password: document.getElementById("reg_password").value,
          }),
        });
        document.getElementById("reg_out").textContent = JSON.stringify(await res.json(), null, 2);
      }

      async function login() {
        const res = await fetch(`/auth/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: document.getElementById("login_email").value,
            password: document.getElementById("login_password").value,
          }),
        });
        const data = await res.json();
        const { access_token, ...safeData } = data || {};
        document.getElementById("login_out").textContent = JSON.stringify(safeData, null, 2);
        if (access_token) {
          localStorage.setItem(tokenKey, access_token);
          document.getElementById("token_out").textContent = "JWT stored";
        }
      }

      async function clearToken() {
        localStorage.removeItem(tokenKey);
        await fetch(`/auth/logout`, { method: "POST" });
        document.getElementById("token_out").textContent = "JWT cleared";
      }

      const existing = localStorage.getItem(tokenKey);
      if (existing) {
        document.getElementById("token_out").textContent = "JWT stored";
      }
    </script>
  </body>
</html>
